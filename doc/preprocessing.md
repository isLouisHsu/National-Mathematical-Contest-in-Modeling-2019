# 数据预处理

## 时间戳

调用`datetime.datetime.strptime(timestamp, "%Y/%m/%d %H:%M:%S")`将字符串时间戳转换为Unix时间戳。

## 速度值

1. 原始GPS测取数据；
2. 利用经纬度计算速度；

- 由于经纬度计算得到速度值噪声过多，故不考虑使用；
- 加速度计参数未使用；

原始数据中速度统计图如下

![1_gpsSpeed](../images/1_gpsSpeed.png)

## 划分运动学片段

1. 按时间戳，将缺失的数据补齐，用线性插值方法补齐；
2. 设定速度阈值，小于该阈值视作怠速；
3. 运动学片段从**上一周期的减速结算结束**开始，到**这一周期的减速阶段结束**；

![0_sequence_sample](../images/0_sequence_sample.png)

## 计算运动学片段特征

1. 若怠速时长大于阈值(180)，则剪裁速度值序列；
2. 计算以下参数，保存
    - 时长
    - 距离
    - 怠速时间比
    - 加速时间
    - 减速时间
    - 峰值速度
    - 平均运行速度
    - 平均速度
    - 速度标准差
    - 峰值加速度
    - 峰值减速度
    - 平均加速度
    - 加速度标准差
    - 平均减速度
    - 减速度标准差
  
所有运动学片段，峰值速度与运行速度直方图统计如下

![1_maxSpeed_feat](../images/1_maxSpeed_feat.png)

![1_movingTime_feat](../images/1_movingTime_feat.png)

## 预处理步骤

### 1. 切分序列

- 统计文件中时间戳，将时间间隔超过1200s(20min)的连续记录分割，例如分割点为n个；
- 在n+1个子序列中设置速度阈值，如1，判断是否为怠速，取前一序列的末端到本序列的末端为一个运动学片段；

### 2. 计算特征

将上步骤切割出的运动学片段$seq^{(i)} = \{v^{(i)}_1, v^{(i)}_2, \cdots, v^{(i)}_n\}$，对应时间点为$time^{(i)} = \{t^{(i)}_1, t^{(i)}_2, \cdots, t^{(i)}_n\}$，在计算加速前，进行均值滤波

$$ v^{(i)}_j := \frac{1}{3} (v^{(i)}_{j-1} + v^{(i)}_j + v^{(i)}_{j+1}) $$

然后，利用下式求解其加速度$acc^{(i)} = \{a^{(i)}_1, a^{(i)}_2, \cdots, a^{(i)}_n\}$

$$
a^{(i)}_j = \begin{cases}
    0 & j = 1 \\
    \frac{v^{(i)}_i - v^{(i)}_{i-1}}{t^{(i)}_i - t^{(i)}_{i-1}} & \rm{otherwise}
\end{cases}
$$

用$seq^{(i)}$与$acc^{(i)}$计算相应特征。

### 3. 根据阈值删除部分异常序列

1. 设定峰值速度阈值$1.0 km/h$，小于该阈值的序列删除；
2. 设定运行时长阈值$4s$，小于该阈值的序列删除；
3. 设定总时长阈值$10s$，小于该阈值的序列删除；
4. 设定最大加速度阈值$4 m/s^2$，大于该阈值的序列删除；
5. 设定最小减速度阈值$-8 m/s^2$，小于该阈值的序列删除；

### 4. 补齐剩余序列

用线性插值方法，根据时间点进行序列补齐。